**********************************************************************  00001000
*                                                                       00002000
*  SABRDB .... STATIC SQL READ MODULE                                   00003000
*                                                                       00004000
*  CREATION DATE: 04/25/16                                              00005000
*                                                                       00006000
*  FUNCTIONAL DESCRIPTION: THIS PROGRAM CONTAINS THE STATIC SQL         00007000
*  VECTORS REQUIRED TO SUPPORT I/O TO THE SAB TABLE.  IT IS LOADED      00008000
*  BY THE DB2 I/O MANAGER (BIPDB2X).  THIS PROGRAM WILL BE USED         00009000
*  IN BOTH A CICS AND BATCH ENVIRONMENT AND MUST BE RE-ENTRANT          00010000
*  AND VOID OF SVC CALLS.                                               00011000
*                                                                       00012000
*     ***************************************************************   00013000
*     *                                                             *   00013001
*     *                           NOTICE                            *   00013002
*     *                                                             *   00013003
*     *   THIS SOFTWARE IS THE PROPERTY OF AND CONTAINS             *   00013004
*     *   CONFIDENTIAL INFORMATION OF INFOR AND/OR ITS AFFILIATES   *   00013005
*     *   OR SUBSIDIARIES AND SHALL NOT BE DISCLOSED WITHOUT PRIOR  *   00013006
*     *   WRITTEN PERMISSION. LICENSED CUSTOMERS MAY COPY AND       *   00013007
*     *   ADAPT THIS SOFTWARE FOR THEIR OWN USE IN ACCORDANCE WITH  *   00013008
*     *   THE TERMS OF THEIR SOFTWARE LICENSE AGREEMENT.            *   00013009
*     *   ALL OTHER RIGHTS RESERVED.                                *   00013010
*     *                                                             *   00013011
*     *   (C) COPYRIGHT 2017 INFOR.  ALL RIGHTS RESERVED.           *   00013012
*     *   THE WORD AND DESIGN MARKS SET FORTH HEREIN ARE            *   00013013
*     *   TRADEMARKS AND/OR REGISTERED TRADEMARKS OF INFOR          *   00013014
*     *   AND/OR ITS AFFILIATES AND SUBSIDIARIES. ALL RIGHTS        *   00013015
*     *   RESERVED.  ALL OTHER TRADEMARKS LISTED HEREIN ARE         *   00013016
*     *   THE PROPERTY OF THEIR RESPECTIVE OWNERS.                  *   00013017
*     *                                                             *   00013018
*     ***************************************************************   00013019
*     *     Infopoint Relationship Pricing                          *   00013020
*     *     RP 5.0.01                                               *   00013021
*     ***************************************************************   00013022
*                                                                       00014000
**********************************************************************  00015000
* SQI COMMUNICATION AREA DSECT ADDRESSED BY REGISTER 11                 00016000
**********************************************************************  00017000
*                                                                       00018000
COM#AREA DSECT                         SQI COMMUNICATION AREA           00019000
SQW@CAF  DS    F                       ADDRESS OF CALL ATTACH FACILITY  00020000
SQW@RET  DS    F                       RETURN TO THIS SQI ADDRESS       00021000
SQWSQLCA DS    XL136                   SQLCA FOR I/O MODULE USE         00022000
         ORG   SQWSQLCA                                                 00023000
         EXEC  SQL INCLUDE SQLCA                                        00024000
SQWSQLDL DS    F                       LENGTH OF DYNAMIC SQLDSECT       00025000
SQWSQLD  DS    F                       DYNAMIC SQLDSECT                 00026000
SQW@SQRX DS    F                       SQI INTERFACE ROUTINE ADDRESS    00027000
SQWPARM1 DS    F                       SQI PARAMETER 1 (MODULE ADDRESS) 00028000
SQWINTHV DS    F                       INTEGER HOST VARIABLE            00029000
SQWCSRBR DS    F                       CURSOR ROUTINE BASE REGISTER     00030000
SQWCSRRA DS    F                       CURSOR ROUTINE RETURN ADDRESS    00031000
SQWRSFVC DS    H                       ROWSET FETCH SQLVAR COUNT        00032000
SQWKMRP  DS    CL1                     SQI KEY MASK / ROUTINE POINTER   00033000
         DS    CL5                     RESERVED                         00034000
SQWIOSI  DS    0CL24                   I/O MODULE STATE INFORMATION     00035000
SQWSQLDA DS    F                       ROWSET SQLDA STORAGE ADDRESS     00036000
SQWRSRMX DS    H                       ROWSET MAX NUMBER OF ROWS        00037000
SQWRSRCT DS    H                       ROWSET RETURNED ROW COUNT        00038000
SQWRSROC DS    H                       ROWSET ROW OCCURS COUNT          00039000
SQWRSFCD DS    H                       ROWSET FETCH SQLCODE             00040000
SQWCSRCA DS    F                       READ CURSOR CLOSE ROUTINE ADDR   00041000
SQWCSUCA DS    F                       UPDATE CURSOR CLOSE ROUTINE ADDR 00042000
SQWCSRLV DS    CL1                     CURSOR CASCADE LEVEL LIMIT       00043000
SQWCSRCC DS    CL1                     CURSOR CASCADE COUNT             00044000
SQWCSRSP DS    H                       CURSOR ROUTINE POINTER           00045000
         DS    CL4                     RESERVED                         00046000
SQWCMD   DS    CL2                     DBS COMMAND CODE                 00047000
SQWORG   DS    CL6                     RECORD ORG CODE                  00048000
ASMREC   DS    0F                      ASSEMBLER RECORD (ALIGNED)       00049000
INST     DS    CL4                                                      00050000
AUDDATE  DS    PL5'0.'                                                  00051000
AUDTIME  DS    PL5'0.'                                                  00052000
AUDUSER  DS    CL8                                                      00053000
AUDORG   DS    CL6                                                      00054000
CURDATE  DS    PL5'0.'                                                  00055000
LPROCDT  DS    PL5'0.'                                                  00056000
NSCHDT   DS    PL5'0.'                                                  00057000
NACTDT   DS    PL5'0.'                                                  00058000
FRSTDOY  DS    PL5'0.'                                                  00059000
LSTDOY   DS    PL5'0.'                                                  00060000
FRSTDOM  DS    PL5'0.'                                                  00061000
LSTDOM   DS    PL5'0.'                                                  00062000
FRSTDOW  DS    PL5'0.'                                                  00063000
LSTDOW   DS    PL5'0.'                                                  00064000
WKFLAG   DS    CL1                                                      00065000
MTHFLAG  DS    CL1                                                      00066000
PRODAY1  DS    CL1                                                      00067000
PRODAY2  DS    CL1                                                      00068000
PRODAY3  DS    CL1                                                      00069000
PRODAY4  DS    CL1                                                      00070000
PRODAY5  DS    CL1                                                      00071000
PRODAY6  DS    CL1                                                      00072000
PRODAY7  DS    CL1                                                      00073000
PRCFLAG  DS    CL1                                                      00074000
CURDAY   DS    CL1                                                      00075000
PRCSOPT  DS    CL1                                                      00076000
INCH     DS    CL1                                                      00077000
RSVFLG   DS    CL1                                                      00078000
RSVDT    DS    PL5'0.'                                                  00079000
RSVDT1   DS    PL5'0.'                                                  00080000
RSVUSER  DS    CL40                                                     00081000
*                                                                       00082000
         ORG   ASMREC+(2000-L'SQWADATA) POINT TO ADDITIONAL DATA        00083000
SQWADATA DS    0CL400                  ADDITIONAL DATA PASSED TO MODULE 00084000
SQWSEGF  DS    CL102                   SEGMENTED FROM KEY VALUE         00085000
SQWSEGT  DS    CL102                   SEGMENTED TO KEY VALUE           00086000
SQWAUDIT DS    CL99                    CALLERS AUDIT DATA               00087000
         DS    CL97                    RESERVED                         00088000
*                                                                       00089000
INDVARS  DS    0H                      NULL INDICATOR VARIABLES         00090000
INDVARX  DS    0H                                                       00091000
INDVARL  EQU   INDVARX-INDVARS         NULL INDICATOR AREA LENGTH       00092000
*                                                                       00093000
*                                                                       00094000
**********************************************************************  00095000
* ROWSET SQLDA AREA ADDRESSED BY REGISTER 2                             00096000
**********************************************************************  00097000
*                                                                       00098000
SQDSQLDA DSECT                         ROWSET SQLDA AREA                00099000
*                                                                       00100000
**********************************************************************  00101000
* PROGRAM TABLE HEADER SECTION:                                         00102000
*   THIS SECTION CONTAINS STATIC DESCRIPTIVE FIELDS.                    00103000
**********************************************************************  00104000
*                                                                       00105000
SABRDB   CSECT                         PROGRAM TABLE SECTION            00106000
SABRDB   AMODE ANY                                                      00107000
SABRDB   RMODE ANY                                                      00108000
         DC    CL8'SABRDB  '           PROGRAM ID                       00109000
         DC    CL1' '                                                   00110000
         DC    CL8'&SYSDATE'           ASSEMBLY DATE                    00111000
         DC    CL1' '                                                   00112000
         DC    CL5'&SYSTIME'           ASSEMBLY TIME                    00113000
         DC    CL1' '                                                   00114000
         DC    A(SQLDLEN)              SQLDSECT SIZE                    00115000
         DC    5A(0)                   RESERVED                         00116000
         DC    AL2(0)                  RESERVED                         00117000
         DC    AL2(INDVARL)            NULL INDICATOR AREA LENGTH       00118000
         DC    A(CONVTAB1)             RECORD/HOST CONVERSION TABLE     00119000
         DC    A(CONVTAB2)             SQLDA DATA TYPE/LENGTH TABLE     00120000
         DC    A(STM#TAB)              STATEMENT TABLE ADDRESS          00121000
         DC    CL43'COPYRIGHT 2017 INFOR. ALL RIGHTS RESERVED. '        00122000
         DC    CL29'WWW.INFOR.COM                '                      00122001
*                                                                       00123000
**********************************************************************  00124000
* STATEMENT TABLE SECTION:                                              00125000
*   THIS SECTION DEFINES AN ENTRY VECTOR FOR EACH SQL STATEMENT.        00126000
**********************************************************************  00127000
*                                                                       00128000
STM#TAB  CSECT                         STATEMENT TABLE SECTION          00129000
STM#TAB  AMODE ANY                                                      00130000
STM#TAB  RMODE ANY                                                      00131000
         DC    A(SELIN0)               SELECT INTO (KEY 0)              00132000
         DC    A(SELIN1)               SELECT INTO (KEY 1)              00133000
         DC    A(SELIN2)               SELECT INTO (KEY 2)              00134000
         DC    A(SELIN3)               SELECT INTO (KEY 3)              00135000
         DC    12A(0)                  UDB MODULE VECTORS               00136000
         DC    A(SELXC0)               SELECT SEQ CURSOR (KEY 0)        00137000
         DC    A(SELXC1)               SELECT SEQ CURSOR (KEY 1)        00138000
         DC    A(SELXC2)               SELECT SEQ CURSOR (KEY 2)        00139000
         DC    A(SELXC3)               SELECT SEQ CURSOR (KEY 3)        00140000
         DC    A(FETDC0)               FETCH SEQ DATA CURSOR (KEY 0)    00141000
         DC    A(FETDC1)               FETCH SEQ DATA CURSOR (KEY 1)    00142000
         DC    A(FETDC2)               FETCH SEQ DATA CURSOR (KEY 2)    00143000
         DC    A(FETDC3)               FETCH SEQ DATA CURSOR (KEY 3)    00144000
         DC    A(FETKC0)               FETCH SEQ KEY CURSOR (KEY 0)     00145000
         DC    A(FETKC1)               FETCH SEQ KEY CURSOR (KEY 1)     00146000
         DC    A(FETKC2)               FETCH SEQ KEY CURSOR (KEY 2)     00147000
         DC    A(FETKC3)               FETCH SEQ KEY CURSOR (KEY 3)     00148000
         DC    A(CLSXC0)               CLOSE SEQ CURSOR (KEY 0)         00149000
         DC    A(CLSXC1)               CLOSE SEQ CURSOR (KEY 1)         00150000
         DC    A(CLSXC2)               CLOSE SEQ CURSOR (KEY 2)         00151000
         DC    A(CLSXC3)               CLOSE SEQ CURSOR (KEY 3)         00152000
         DC    A(SELKY0)               SELECT KEY (KEY 0)               00153000
         DC    A(SELKY1)               SELECT KEY (KEY 1)               00154000
         DC    A(SELKY2)               SELECT KEY (KEY 2)               00155000
         DC    A(SELKY3)               SELECT KEY (KEY 3)               00156000
         DC    10A(0)                  UDB MODULE VECTORS               00157000
         DC    4X'FF'                                                   00158000
*                                                                       00159000
**********************************************************************  00160000
* SQL STATEMENT SECTION:                                                00161000
*   THIS SECTION CONTAINS ALL THE STATIC SQL STATEMENTS REQUIRED        00162000
*     TO SUPPORT THIS TABLE.                                            00163000
*   THE INDICATED STATEMENTS MAY BE MODIFIED, AS LONG AS THE RESULTS    00164000
*     ARE EQUIVALENT.                                                   00165000
**********************************************************************  00166000
*                                                                       00167000
SQL#STMT CSECT                         SQL STATEMENT SECTION            00168000
SQL#STMT AMODE ANY                                                      00169000
SQL#STMT RMODE ANY                                                      00170000
         USING SQDSQLDA,2              ADDRESS ROWSET SQLDA AREA        00171000
         USING SQLDSECT,10             ADDRESS SQLDSECT                 00172000
         USING COM#AREA,11             ADDRESS COMMAREA                 00173000
*                                                                       00174000
**********************************************************************  00175000
* SELECT INTO STATEMENT BY PRIMARY KEY:                                 00176000
*   THIS STATEMENT SUPPORTS THE GET (WITHOUT LOCK) VERB.                00177000
**********************************************************************  00178000
*                                                                       00179000
SELIN0   DS    0H                                                       00180000
         USING SELIN0,12               ESTABLISH BASE REGISTER          00181000
         MVI   SQWKMRP,X'80'           MOVE RECORD TO HOST FOR KEY 0    00182000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00183000
         BALR  14,15                   MOVE REQUESTED DATA              00184000
         EXEC  SQL SELECT                                              *00185000
                   AUDIT_DATE,                                         *00186000
                   AUDIT_TIME,                                         *00187000
                   AUDIT_USER,                                         *00188000
                   AUDIT_ORG,                                          *00189000
                   CURR_PRCS_DATE,                                     *00190000
                   LAST_PRCS_DATE,                                     *00191000
                   NEXT_SCHD_DATE,                                     *00192000
                   NEXT_ACTL_DATE,                                     *00193000
                   FIRST_DAY_YEAR,                                     *00194000
                   LAST_DAY_YEAR,                                      *00195000
                   FIRST_DAY_MONTH,                                    *00196000
                   LAST_DAY_MONTH,                                     *00197000
                   FIRST_DAY_WEEK,                                     *00198000
                   LAST_DAY_WEEK,                                      *00199000
                   WK_PRCS_FLAG,                                       *00200000
                   MONTH_PRCS_FLAG,                                    *00201000
                   PRCS_WK_DAY_1,                                      *00202000
                   PRCS_WK_DAY_2,                                      *00203000
                   PRCS_WK_DAY_3,                                      *00204000
                   PRCS_WK_DAY_4,                                      *00205000
                   PRCS_WK_DAY_5,                                      *00206000
                   PRCS_WK_DAY_6,                                      *00207000
                   PRCS_WK_DAY_7,                                      *00208000
                   PROCESS_FLAG,                                       *00209000
                   CURR_DAY,                                           *00210000
                   PRCS_OPTION,                                        *00211000
                   LINE_INCH,                                          *00212000
                   RSV_FLAG,                                           *00213000
                   RSV_DATE,                                           *00214000
                   RSV_DATE_1,                                         *00215000
                   RSV_USER                                            *00216000
                 INTO                                                  *00217000
                   :AUDDATE,                                           *00218000
                   :AUDTIME,                                           *00219000
                   :AUDUSER,                                           *00220000
                   :AUDORG,                                            *00221000
                   :CURDATE,                                           *00222000
                   :LPROCDT,                                           *00223000
                   :NSCHDT,                                            *00224000
                   :NACTDT,                                            *00225000
                   :FRSTDOY,                                           *00226000
                   :LSTDOY,                                            *00227000
                   :FRSTDOM,                                           *00228000
                   :LSTDOM,                                            *00229000
                   :FRSTDOW,                                           *00230000
                   :LSTDOW,                                            *00231000
                   :WKFLAG,                                            *00232000
                   :MTHFLAG,                                           *00233000
                   :PRODAY1,                                           *00234000
                   :PRODAY2,                                           *00235000
                   :PRODAY3,                                           *00236000
                   :PRODAY4,                                           *00237000
                   :PRODAY5,                                           *00238000
                   :PRODAY6,                                           *00239000
                   :PRODAY7,                                           *00240000
                   :PRCFLAG,                                           *00241000
                   :CURDAY,                                            *00242000
                   :PRCSOPT,                                           *00243000
                   :INCH,                                              *00244000
                   :RSVFLG,                                            *00245000
                   :RSVDT,                                             *00246000
                   :RSVDT1,                                            *00247000
                   :RSVUSER                                            *00248000
                 FROM SAB                                              *00249000
                 WHERE                                                 *00250000
                   INST_NBR = :INST                                    *00251000
                 FETCH FIRST 1 ROW ONLY                                 00252000
         MVI   SQWKMRP,X'03'           MOVE HOST VARIABLES TO RECORD    00253000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00254000
         BALR  14,15                   MOVE REQUESTED DATA              00255000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00256000
         BR    14                      RETURN TO CALLER                 00257000
         LTORG                                                          00258000
*                                                                       00259000
**********************************************************************  00260000
* SELECT COUNT STATEMENT BY PRIMARY KEY:                                00261000
*   THIS STATEMENT SUPPORTS THE LOCATE VERB.                            00262000
**********************************************************************  00263000
*                                                                       00264000
SELKY0   DS    0H                                                       00265000
         USING SELKY0,12               ESTABLISH BASE REGISTER          00266000
         MVI   SQWKMRP,X'80'           MOVE RECORD TO HOST FOR KEY 0    00267000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00268000
         BALR  14,15                   MOVE REQUESTED DATA              00269000
         EXEC  SQL SELECT                                              *00270000
                   COUNT(*)                                            *00271000
                 INTO                                                  *00272000
                   :SQWINTHV                                           *00273000
                 FROM SAB                                              *00274000
                 WHERE                                                 *00275000
                   INST_NBR = :INST                                    *00276000
                 FETCH FIRST 1 ROW ONLY                                 00277000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00278000
         CLC   SQLCODE,=F'0'           GOOD RETURN FROM SQL?            00279000
         BNER  14                      NO - RETURN TO CALLER            00280000
         CLC   SQWINTHV,=F'0'          ANY ROWS MATCH WHERE CLAUSE?     00281000
         BNER  14                      YES - RETURN ZERO SQLCODE        00282000
         MVC   SQLCODE,=F'+100'        SET SQLCODE TO ROW NOT FOUND     00283000
         BR    14                      RETURN TO CALLER                 00284000
         LTORG                                                          00285000
*                                                                       00286000
**********************************************************************  00287000
* SELECT SEQUENTIAL AND OPEN SEQUENTIAL CURSOR STATEMENTS BY PRIMARY    00288000
* KEY:                                                                  00289000
*   THESE STATEMENTS SUPPORT THE GET-GE, GET-GE-LOCK, GET-NEXT,         00290000
*     AND GET-NEXT-LOCK VERBS.                                          00291000
*   A SELECT UPDATE STATEMENT WILL FOLLOW IN THE CASE OF A              00292000
*     GET-GE-LOCK OR GET-NEXT-LOCK VERB.                                00293000
**********************************************************************  00294000
*                                                                       00295000
SELXC0   DS    0H                                                       00296000
         USING SELXC0,12               ESTABLISH BASE REGISTER          00297000
         MVI   SQWKMRP,X'86'           SET HOST KEY 0 & CURSOR POINTER  00298000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00299000
         BALR  14,15                   MOVE DATA & SET CURSOR POINTER   00300000
         LA    12,SELXC0P              LOAD VECTOR TABLE ADDRESS        00301000
         AH    12,SQWCSRSP             COMPUTE POINTER TO OPEN ROUTINE  00302000
         L     12,0(12)                LOAD OPEN ROUTINE ADDRESS        00303000
         BR    12                      GO TO CURSOR OPEN ROUTINE        00304000
SELXC0P  DC    A(SELGE001)                                              00305000
         LTORG                                                          00306000
*                                                                       00307000
SELGE001 DS    0H                                                       00308000
         USING SELGE001,12             ESTABLISH BASE REGISTER          00309000
         EXEC  SQL DECLARE SABGE001 CURSOR                             *00310000
               WITH ROWSET POSITIONING                                 *00311000
               FOR SELECT                                              *00312000
                   INST_NBR,                                           *00313000
                   AUDIT_DATE,                                         *00314000
                   AUDIT_TIME,                                         *00315000
                   AUDIT_USER,                                         *00316000
                   AUDIT_ORG,                                          *00317000
                   CURR_PRCS_DATE,                                     *00318000
                   LAST_PRCS_DATE,                                     *00319000
                   NEXT_SCHD_DATE,                                     *00320000
                   NEXT_ACTL_DATE,                                     *00321000
                   FIRST_DAY_YEAR,                                     *00322000
                   LAST_DAY_YEAR,                                      *00323000
                   FIRST_DAY_MONTH,                                    *00324000
                   LAST_DAY_MONTH,                                     *00325000
                   FIRST_DAY_WEEK,                                     *00326000
                   LAST_DAY_WEEK,                                      *00327000
                   WK_PRCS_FLAG,                                       *00328000
                   MONTH_PRCS_FLAG,                                    *00329000
                   PRCS_WK_DAY_1,                                      *00330000
                   PRCS_WK_DAY_2,                                      *00331000
                   PRCS_WK_DAY_3,                                      *00332000
                   PRCS_WK_DAY_4,                                      *00333000
                   PRCS_WK_DAY_5,                                      *00334000
                   PRCS_WK_DAY_6,                                      *00335000
                   PRCS_WK_DAY_7,                                      *00336000
                   PROCESS_FLAG,                                       *00337000
                   CURR_DAY,                                           *00338000
                   PRCS_OPTION,                                        *00339000
                   LINE_INCH,                                          *00340000
                   RSV_FLAG,                                           *00341000
                   RSV_DATE,                                           *00342000
                   RSV_DATE_1,                                         *00343000
                   RSV_USER                                            *00344000
                 FROM SAB                                              *00345000
                 WHERE                                                 *00346000
                   INST_NBR >=                                         *00347000
                     :INST                                             *00348000
                 ORDER BY INST_NBR ASC                                 *00349000
                 OPTIMIZE FOR 1 ROW FOR READ ONLY                       00350000
         EXEC  SQL OPEN SABGE001                                        00351000
         MVC   SQWCSRCA,=A(CLSGE001)   SET CURSOR CLOSE ROUTINE ADDRESS 00352000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00353000
         BR    14                      RETURN TO CALLER                 00354000
         LTORG                                                          00355000
*                                                                       00356000
**********************************************************************  00357000
* SELECT AND OPEN SEQUENTIAL CURSOR STATEMENTS BY PRIMARY KEY:          00358000
*   THIS ROUTINE HANDLES PRIMARY KEY SEQUENTIAL CURSORS.                00359000
**********************************************************************  00360000
*                                                                       00361000
NXTXC0   DS    0H                                                       00362000
         USING NXTXC0,12               ESTABLISH BASE REGISTER          00363000
         MVI   SQWKMRP,X'87'           CLOSE CURSOR & SET HOST KEY 0    00364000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00365000
         BALR  14,15                   MOVE REQUESTED DATA              00366000
         LH    1,SQWCSRSP              LOAD CURRENT CURSOR POINTER      00367000
         LA    1,4(1)                  INCREMENT TO NEXT CURSOR         00368000
         STH   1,SQWCSRSP              SAVE POINTER FOR NEXT CALL       00369000
         LA    12,NXTXC0P(1)           LOAD POINTER TO NEXT CURSOR      00370000
         L     12,0(12)                LOAD CURSOR ROUTINE ADDRESS      00371000
         BR    12                      GO TO CURRENT CURSOR ROUTINE     00372000
NXTXC0P  DC    A(0)                                                     00373000
         DC    A(NXTGT099)                                              00374000
NXTGT099 LA    0,4                     LOAD VALUE 4 IN REGISTER 0       00375000
         SR    1,0                     ADJUST BACK TO CURRENT POINTER   00376000
         STH   1,SQWCSRSP              SAVE POINTER FOR CURSOR CLOSE    00377000
         LA    0,100                   LOAD VALUE 100 IN REGISTER 0     00378000
         ST    0,SQLCODE               SET SQLCODE TO NO MORE ROWS      00379000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00380000
         BR    14                      RETURN TO SQI                    00381000
         LTORG                                                          00382000
*                                                                       00383000
**********************************************************************  00384000
* FETCH FROM SEQUENTIAL CURSOR STATEMENT FOR PRIMARY KEY:               00385000
*   THIS STATEMENT SUPPORTS THE GET-GE AND GET-NEXT VERBS.              00386000
*   IT WILL FOLLOW A SUCCESSFUL SELECT SEQUENTIAL STATEMENT TO          00387000
*     RETRIEVE THE ACTUAL ROW.                                          00388000
*   THE GET-GE-LOCK AND GET-NEXT-LOCK VERBS USE A DIFFERENT             00389000
*     FETCH STATEMENT AS ONLY THE KEY FIELDS ARE NEEDED.                00390000
**********************************************************************  00391000
*                                                                       00392000
FETDC0   DS    0H                                                       00393000
         USING FETDC0,12               ESTABLISH BASE REGISTER          00394000
         MVC   SQWCSRRA,=A(FETDC0)     SET RETURN ROUTINE ADDRESS       00395000
         MVC   SQWCSRBR,=A(NXTXC0)     SET CURSOR ROUTINE ADDRESS       00396000
         MVC   SQWRSFVC,=AL2(TBLCOLMS) FETCH ALL COLUMNS IN TABLE       00397000
         LH    1,SQWCSRSP              LOAD CURRENT CURSOR POINTER      00398000
         LA    12,FETDC0P(1)           LOAD POINTER TO FETCH ROUTINE    00399000
         L     12,0(12)                LOAD FETCH ROUTINE ADDRESS       00400000
         BR    12                      GO TO CURRENT FETCH ROUTINE      00401000
FETDC0P  DC    A(FETGE001)                                              00402000
         DC    A(0)                                                     00403000
         LTORG                                                          00404000
*                                                                       00405000
**********************************************************************  00406000
* FETCH FROM SEQUENTIAL CURSOR FOR EVENTUAL UPDATE STATEMENT FOR        00407000
* THE PRIMARY KEY:                                                      00408000
*   THIS STATEMENT SUPPORTS THE GET-GE-LOCK AND GET-NEXT-LOCK           00409000
*     VERBS.                                                            00410000
*   IT WILL FOLLOW A SUCCESSFUL SELECT SEQUENTIAL STATEMENT TO          00411000
*     RETRIEVE THE ACTUAL ROW.                                          00412000
*   ONLY THE PRIMARY KEY FIELDS ARE RETRIEVED AS A SELECT FOR UPDATE    00413000
*     STATEMENT WILL FOLLOW AND RETREIVAL OF THE ACTUAL ROW             00414000
*     WILL BE THRU THE UPDATE CURSOR.                                   00415000
**********************************************************************  00416000
*                                                                       00417000
FETKC0   DS    0H                                                       00418000
         USING FETKC0,12               ESTABLISH BASE REGISTER          00419000
         MVC   SQWCSRRA,=A(FETKC0)     SET RETURN ROUTINE ADDRESS       00420000
         MVC   SQWCSRBR,=A(NXTXC0)     SET CURSOR ROUTINE ADDRESS       00421000
         MVC   SQWRSFVC,=AL2(KY0COLMS) ONLY FETCH KEY COLUMNS           00422000
         LH    1,SQWCSRSP              LOAD CURRENT CURSOR POINTER      00423000
         LA    12,FETKC0P(1)           LOAD POINTER TO FETCH ROUTINE    00424000
         L     12,0(12)                LOAD FETCH ROUTINE ADDRESS       00425000
         BR    12                      GO TO CURRENT FETCH ROUTINE      00426000
FETKC0P  DC    A(FETGE001)                                              00427000
         DC    A(0)                                                     00428000
         LTORG                                                          00429000
*                                                                       00430000
FETGE001 DS    0H                                                       00431000
         USING FETGE001,12             ESTABLISH BASE REGISTER          00432000
         MVI   SQWKMRP,X'04'           CHECK FOR MORE ROWS IN ROWSET    00433000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00434000
         BALR  14,15                   MOVE REQUESTED DATA              00435000
         EXEC  SQL FETCH NEXT ROWSET FROM SABGE001                     *00436000
               FOR :SQWRSRMX ROWS INTO DESCRIPTOR :SQDSQLDA             00437000
         MVI   SQWKMRP,X'05'           MOVE HOST ARRAY DATA TO RECORD   00438000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00439000
         BALR  14,15                   MOVE REQUESTED DATA              00440000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00441000
         BR    14                      RETURN TO CALLER                 00442000
         LTORG                                                          00443000
*                                                                       00444000
**********************************************************************  00445000
* CLOSE SEQUENTIAL CURSOR STATEMENT FOR PRIMARY KEY:                    00446000
*   THIS STATEMENT SUPPORTS THE GET-GE, GET-GE-LOCK, GET-NEXT,          00447000
*     AND GET-NEXT-LOCK VERBS.                                          00448000
*   IT WILL FOLLOW THE LAST FETCH FROM SEQUENTIAL CURSOR STATEMENT      00449000
*     TO CLOSE THE SEQUENTIAL CURSOR.                                   00450000
**********************************************************************  00451000
*                                                                       00452000
CLSXC0   DS    0H                                                       00453000
         USING CLSXC0,12               ESTABLISH BASE REGISTER          00454000
         L     12,SQWCSRCA             SET CURSOR CLOSE ROUTINE ADDRESS 00455000
         XC    SQWCSRCA,SQWCSRCA       CLEAR CURSOR CLOSE ROUTINE ADDR  00456000
         BR    12                      GO TO CURSOR CLOSE ROUTINE       00457000
         LTORG                                                          00458000
*                                                                       00459000
CLSGE001 DS    0H                                                       00460000
         USING CLSGE001,12             ESTABLISH BASE REGISTER          00461000
         EXEC  SQL CLOSE SABGE001                                       00462000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00463000
         BR    14                      RETURN TO CALLER                 00464000
         LTORG                                                          00465000
*                                                                       00466000
**********************************************************************  00467000
* ALTERNATE KEY 1 NOT DEFINED                                           00468000
**********************************************************************  00469000
*                                                                       00470000
SELIN1   DS    0H                                                       00471000
SELKY1   DS    0H                                                       00472000
SELXC1   DS    0H                                                       00473000
FETDC1   DS    0H                                                       00474000
FETKC1   DS    0H                                                       00475000
CLSXC1   DS    0H                                                       00476000
         DC    X'00DEAD01'             FORCE S0C1 ABEND                 00477000
*                                                                       00478000
**********************************************************************  00479000
* ALTERNATE KEY 2 NOT DEFINED                                           00480000
**********************************************************************  00481000
*                                                                       00482000
SELIN2   DS    0H                                                       00483000
SELKY2   DS    0H                                                       00484000
SELXC2   DS    0H                                                       00485000
FETDC2   DS    0H                                                       00486000
FETKC2   DS    0H                                                       00487000
CLSXC2   DS    0H                                                       00488000
         DC    X'00DEAD02'             FORCE S0C1 ABEND                 00489000
*                                                                       00490000
**********************************************************************  00491000
* ALTERNATE KEY 3 NOT DEFINED                                           00492000
**********************************************************************  00493000
*                                                                       00494000
SELIN3   DS    0H                                                       00495000
SELKY3   DS    0H                                                       00496000
SELXC3   DS    0H                                                       00497000
FETDC3   DS    0H                                                       00498000
FETKC3   DS    0H                                                       00499000
CLSXC3   DS    0H                                                       00500000
         DC    X'00DEAD03'             FORCE S0C1 ABEND                 00501000
*                                                                       00502000
         DS    0H                      END OF SQL STATEMENTS            00503000
         DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF'                   00504000
*                                                                       00505000
**********************************************************************  00506000
* DUMMY ENTRY POINT DSNHLI                                              00507000
**********************************************************************  00508000
*                                                                       00509000
         ENTRY DSNHLI                                                   00510000
DSNHLI   DS    0H                                                       00511000
         L     15,SQW@CAF              LOAD ENTRY POINT TO ATTACH       00512000
         BR    15                      BRANCH TO ATTACH FACILITY        00513000
*                                                                       00514000
**********************************************************************  00515000
* CONVERSION TABLE VALUES FOR ALL FIELDS IN THIS TABLE                  00516000
**********************************************************************  00517000
*                                                                       00518000
* CONVTAB1 TABLE ENTRY FORMAT IS:                                       00519000
*        DC    H'RRRR',H'VVVV',H'LLLL',X'KK',X'DD'                      00520000
* OR:                                                                   00521000
*        DC    H'RRRR',H'VVVV',X'ZZPP',X'KK',X'DD'                      00522000
* WHERE:                                                                00523000
*   RRRR = RECORD AREA OFFSET                                           00524000
*   VVVV = HOST VARIABLE AREA OFFSET                                    00525000
*   LLLL = HALFWORD LENGTH TO MOVE                                      00526000
*   ZZPP = CONVERT ZONED/PACKED LENGTHS (MINUS 1)                       00527000
*   KK   = KEY FIELD MASK:                                              00528000
*            80 = KEY 0 FIELD                                           00529000
*            40 = KEY 1 FIELD                                           00530000
*            20 = KEY 2 FIELD                                           00531000
*            10 = KEY 3 FIELD                                           00532000
*   DD   = DATA FIELD MASK:                                             00533000
*            80 = RECORD FIELD IS PACKED                                00534000
*            40 = HOST VARIABLE IS PACKED                               00535000
*            20 = NULLABLE FIELD                                        00536000
*            01 = DATE FIELD                                            00537000
*            02 = TIME FIELD                                            00538000
*                                                                       00539000
CONVTAB1 DS    0H                      RECORD/HOST VARIABLE CONVERSIONS 00540000
         DC    H'0000',H'0000',H'0004',X'80',X'00'                      00541000
         DC    H'0004',H'0004',H'0138',X'00',X'00'                      00542000
         DC    8X'FF'                                                   00543000
*                                                                       00544000
* CONVTAB2 TABLE COLUMNS ENTRY FORMAT IS:                               00545000
*        DC    H'RRRR',H'LLLL',H'TTTT'                                  00546000
* OR:                                                                   00547000
*        DC    H'RRRR',X'PPSS',H'TTTT'                                  00548000
* WHERE:                                                                00549000
*   RRRR = RECORD AREA OFFSET                                           00550000
*   LLLL = HALFWORD LENGTH OF HOST VARIABLE (NON-DECIMAL DATA TYPE)     00551000
*   PPSS = PRECISION AND SCALE (DECIMAL DATA TYPE)                      00552000
*   TTTT = SQLDA DATA TYPE:                                             00553000
*            452 = CHAR       453 = CHAR NULLABLE                       00554000
*            484 = DECIMAL    485 = DECIMAL NULLABLE                    00555000
*            496 = INTEGER    497 = INTEGER NULLABLE                    00556000
*            500 = SMALLINT   501 = SMALLINT NULLABLE                   00557000
*                                                                       00558000
CONVTAB2 DS    0F                      RECORD DATA ATTRIBUTE TABLE      00559000
         DC    AL4(TBLCOLMS*44+16)     TOTAL SQLDA SIZE                 00560000
         DC    AL2(TBLCOLMS)           NUMBER OF COLUMNS IN TABLE       00561000
         DC    AL2(KY0COLMS)           NUMBER OF PRIMARY KEY COLUMNS    00562000
         DC    AL2(KY1COLMS)           NUMBER OF ALT1 KEY COLUMNS       00563000
         DC    AL2(KY2COLMS)           NUMBER OF ALT2 KEY COLUMNS       00564000
         DC    AL2(KY3COLMS)           NUMBER OF ALT3 KEY COLUMNS       00565000
         DC    AL2(00142)              SUMMATION OF ALL COLUMN LENGTHS  00566000
         DC    AL2(01000)              PRIMARY MULTIROW FETCH ARRAY     00567000
         DC    AL2(00000)              ALT 1 MULTIROW FETCH ARRAY       00568000
         DC    AL2(00000)              ALT 2 MULTIROW FETCH ARRAY       00569000
         DC    AL2(00000)              ALT 3 MULTIROW FETCH ARRAY       00570000
         DC    AL2(00000)              PRIMARY KEY LOW VALUE LEVEL      00571000
         DC    AL2(00000)              ALT 1 KEY LOW VALUE LEVEL        00572000
         DC    AL2(00000)              ALT 2 KEY LOW VALUE LEVEL        00573000
         DC    AL2(00000)              ALT 3 KEY LOW VALUE LEVEL        00574000
CONVDATA DS    0H                                                       00575000
         DC    H'0000',H'0004',H'452'  INST_NBR                         00576000
KEYCOLMS EQU   (*-CONVDATA)/6          NUMBER OF KEY COLUMNS IN TABLE   00577000
         DC    H'0004',X'0900',H'484'  AUDIT_DATE                       00578000
         DC    H'0009',X'0900',H'484'  AUDIT_TIME                       00579000
         DC    H'0014',H'0008',H'452'  AUDIT_USER                       00580000
         DC    H'0022',H'0006',H'452'  AUDIT_ORG                        00581000
         DC    H'0028',X'0900',H'484'  CURR_PRCS_DATE                   00582000
         DC    H'0033',X'0900',H'484'  LAST_PRCS_DATE                   00583000
         DC    H'0038',X'0900',H'484'  NEXT_SCHD_DATE                   00584000
         DC    H'0043',X'0900',H'484'  NEXT_ACTL_DATE                   00585000
         DC    H'0048',X'0900',H'484'  FIRST_DAY_YEAR                   00586000
         DC    H'0053',X'0900',H'484'  LAST_DAY_YEAR                    00587000
         DC    H'0058',X'0900',H'484'  FIRST_DAY_MONTH                  00588000
         DC    H'0063',X'0900',H'484'  LAST_DAY_MONTH                   00589000
         DC    H'0068',X'0900',H'484'  FIRST_DAY_WEEK                   00590000
         DC    H'0073',X'0900',H'484'  LAST_DAY_WEEK                    00591000
         DC    H'0078',H'0001',H'452'  WK_PRCS_FLAG                     00592000
         DC    H'0079',H'0001',H'452'  MONTH_PRCS_FLAG                  00593000
         DC    H'0080',H'0001',H'452'  PRCS_WK_DAY_1                    00594000
         DC    H'0081',H'0001',H'452'  PRCS_WK_DAY_2                    00595000
         DC    H'0082',H'0001',H'452'  PRCS_WK_DAY_3                    00596000
         DC    H'0083',H'0001',H'452'  PRCS_WK_DAY_4                    00597000
         DC    H'0084',H'0001',H'452'  PRCS_WK_DAY_5                    00598000
         DC    H'0085',H'0001',H'452'  PRCS_WK_DAY_6                    00599000
         DC    H'0086',H'0001',H'452'  PRCS_WK_DAY_7                    00600000
         DC    H'0087',H'0001',H'452'  PROCESS_FLAG                     00601000
         DC    H'0088',H'0001',H'452'  CURR_DAY                         00602000
         DC    H'0089',H'0001',H'452'  PRCS_OPTION                      00603000
         DC    H'0090',H'0001',H'452'  LINE_INCH                        00604000
         DC    H'0091',H'0001',H'452'  RSV_FLAG                         00605000
         DC    H'0092',X'0900',H'484'  RSV_DATE                         00606000
         DC    H'0097',X'0900',H'484'  RSV_DATE_1                       00607000
         DC    H'0102',H'0040',H'452'  RSV_USER                         00608000
TBLCOLMS EQU   (*-CONVDATA)/6          NUMBER OF COLUMNS IN TABLE       00609000
KY0COLMS EQU   00001                   NUMBER OF PRIMARY KEY COLUMNS    00610000
KY1COLMS EQU   00000                   NUMBER OF ALT 1 KEY COLUMNS      00611000
KY2COLMS EQU   00000                   NUMBER OF ALT 2 KEY COLUMNS      00612000
KY3COLMS EQU   00000                   NUMBER OF ALT 3 KEY COLUMNS      00613000
*                                                                       00614000
         LTORG                                                          00615000
         END                                                            00616000
