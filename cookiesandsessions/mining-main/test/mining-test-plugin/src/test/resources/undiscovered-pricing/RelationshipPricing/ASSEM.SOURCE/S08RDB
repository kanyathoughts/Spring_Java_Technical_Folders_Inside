**********************************************************************  00001000
*                                                                       00002000
*  S08RDB .... STATIC SQL READ MODULE                                   00003000
*                                                                       00004000
*  CREATION DATE: 04/25/16                                              00005000
*                                                                       00006000
*  FUNCTIONAL DESCRIPTION: THIS PROGRAM CONTAINS THE STATIC SQL         00007000
*  VECTORS REQUIRED TO SUPPORT I/O TO THE S08 TABLE.  IT IS LOADED      00008000
*  BY THE DB2 I/O MANAGER (BIPDB2X).  THIS PROGRAM WILL BE USED         00009000
*  IN BOTH A CICS AND BATCH ENVIRONMENT AND MUST BE RE-ENTRANT          00010000
*  AND VOID OF SVC CALLS.                                               00011000
*                                                                       00012000
*     ***************************************************************   00013000
*     *                                                             *   00013001
*     *                           NOTICE                            *   00013002
*     *                                                             *   00013003
*     *   THIS SOFTWARE IS THE PROPERTY OF AND CONTAINS             *   00013004
*     *   CONFIDENTIAL INFORMATION OF INFOR AND/OR ITS AFFILIATES   *   00013005
*     *   OR SUBSIDIARIES AND SHALL NOT BE DISCLOSED WITHOUT PRIOR  *   00013006
*     *   WRITTEN PERMISSION. LICENSED CUSTOMERS MAY COPY AND       *   00013007
*     *   ADAPT THIS SOFTWARE FOR THEIR OWN USE IN ACCORDANCE WITH  *   00013008
*     *   THE TERMS OF THEIR SOFTWARE LICENSE AGREEMENT.            *   00013009
*     *   ALL OTHER RIGHTS RESERVED.                                *   00013010
*     *                                                             *   00013011
*     *   (C) COPYRIGHT 2017 INFOR.  ALL RIGHTS RESERVED.           *   00013012
*     *   THE WORD AND DESIGN MARKS SET FORTH HEREIN ARE            *   00013013
*     *   TRADEMARKS AND/OR REGISTERED TRADEMARKS OF INFOR          *   00013014
*     *   AND/OR ITS AFFILIATES AND SUBSIDIARIES. ALL RIGHTS        *   00013015
*     *   RESERVED.  ALL OTHER TRADEMARKS LISTED HEREIN ARE         *   00013016
*     *   THE PROPERTY OF THEIR RESPECTIVE OWNERS.                  *   00013017
*     *                                                             *   00013018
*     ***************************************************************   00013019
*     *     Infopoint Relationship Pricing                          *   00013020
*     *     RP 5.0.01                                               *   00013021
*     ***************************************************************   00013022
*                                                                       00014000
**********************************************************************  00015000
* SQI COMMUNICATION AREA DSECT ADDRESSED BY REGISTER 11                 00016000
**********************************************************************  00017000
*                                                                       00018000
COM#AREA DSECT                         SQI COMMUNICATION AREA           00019000
SQW@CAF  DS    F                       ADDRESS OF CALL ATTACH FACILITY  00020000
SQW@RET  DS    F                       RETURN TO THIS SQI ADDRESS       00021000
SQWSQLCA DS    XL136                   SQLCA FOR I/O MODULE USE         00022000
         ORG   SQWSQLCA                                                 00023000
         EXEC  SQL INCLUDE SQLCA                                        00024000
SQWSQLDL DS    F                       LENGTH OF DYNAMIC SQLDSECT       00025000
SQWSQLD  DS    F                       DYNAMIC SQLDSECT                 00026000
SQW@SQRX DS    F                       SQI INTERFACE ROUTINE ADDRESS    00027000
SQWPARM1 DS    F                       SQI PARAMETER 1 (MODULE ADDRESS) 00028000
SQWINTHV DS    F                       INTEGER HOST VARIABLE            00029000
SQWCSRBR DS    F                       CURSOR ROUTINE BASE REGISTER     00030000
SQWCSRRA DS    F                       CURSOR ROUTINE RETURN ADDRESS    00031000
SQWRSFVC DS    H                       ROWSET FETCH SQLVAR COUNT        00032000
SQWKMRP  DS    CL1                     SQI KEY MASK / ROUTINE POINTER   00033000
         DS    CL5                     RESERVED                         00034000
SQWIOSI  DS    0CL24                   I/O MODULE STATE INFORMATION     00035000
SQWSQLDA DS    F                       ROWSET SQLDA STORAGE ADDRESS     00036000
SQWRSRMX DS    H                       ROWSET MAX NUMBER OF ROWS        00037000
SQWRSRCT DS    H                       ROWSET RETURNED ROW COUNT        00038000
SQWRSROC DS    H                       ROWSET ROW OCCURS COUNT          00039000
SQWRSFCD DS    H                       ROWSET FETCH SQLCODE             00040000
SQWCSRCA DS    F                       READ CURSOR CLOSE ROUTINE ADDR   00041000
SQWCSUCA DS    F                       UPDATE CURSOR CLOSE ROUTINE ADDR 00042000
SQWCSRLV DS    CL1                     CURSOR CASCADE LEVEL LIMIT       00043000
SQWCSRCC DS    CL1                     CURSOR CASCADE COUNT             00044000
SQWCSRSP DS    H                       CURSOR ROUTINE POINTER           00045000
         DS    CL4                     RESERVED                         00046000
SQWCMD   DS    CL2                     DBS COMMAND CODE                 00047000
SQWORG   DS    CL6                     RECORD ORG CODE                  00048000
ASMREC   DS    0F                      ASSEMBLER RECORD (ALIGNED)       00049000
INST     DS    CL4                                                      00050000
RECNBR   DS    CL4                                                      00051000
SECSVCCD DS    CL6                                                      00052000
AUDDATE  DS    PL5'0.'                                                  00053000
AUDTIME  DS    PL5'0.'                                                  00054000
AUDUSER  DS    CL8                                                      00055000
AUDORG   DS    CL6                                                      00056000
DESCRIPT DS    CL30                                                     00057000
*                                                                       00058000
         ORG   ASMREC+(2000-L'SQWADATA) POINT TO ADDITIONAL DATA        00059000
SQWADATA DS    0CL400                  ADDITIONAL DATA PASSED TO MODULE 00060000
SQWSEGF  DS    CL102                   SEGMENTED FROM KEY VALUE         00061000
SQWSEGT  DS    CL102                   SEGMENTED TO KEY VALUE           00062000
SQWAUDIT DS    CL99                    CALLERS AUDIT DATA               00063000
         DS    CL97                    RESERVED                         00064000
*                                                                       00065000
INDVARS  DS    0H                      NULL INDICATOR VARIABLES         00066000
INDVARX  DS    0H                                                       00067000
INDVARL  EQU   INDVARX-INDVARS         NULL INDICATOR AREA LENGTH       00068000
*                                                                       00069000
*                                                                       00070000
**********************************************************************  00071000
* ROWSET SQLDA AREA ADDRESSED BY REGISTER 2                             00072000
**********************************************************************  00073000
*                                                                       00074000
SQDSQLDA DSECT                         ROWSET SQLDA AREA                00075000
*                                                                       00076000
**********************************************************************  00077000
* PROGRAM TABLE HEADER SECTION:                                         00078000
*   THIS SECTION CONTAINS STATIC DESCRIPTIVE FIELDS.                    00079000
**********************************************************************  00080000
*                                                                       00081000
S08RDB   CSECT                         PROGRAM TABLE SECTION            00082000
S08RDB   AMODE ANY                                                      00083000
S08RDB   RMODE ANY                                                      00084000
         DC    CL8'S08RDB  '           PROGRAM ID                       00085000
         DC    CL1' '                                                   00086000
         DC    CL8'&SYSDATE'           ASSEMBLY DATE                    00087000
         DC    CL1' '                                                   00088000
         DC    CL5'&SYSTIME'           ASSEMBLY TIME                    00089000
         DC    CL1' '                                                   00090000
         DC    A(SQLDLEN)              SQLDSECT SIZE                    00091000
         DC    5A(0)                   RESERVED                         00092000
         DC    AL2(0)                  RESERVED                         00093000
         DC    AL2(INDVARL)            NULL INDICATOR AREA LENGTH       00094000
         DC    A(CONVTAB1)             RECORD/HOST CONVERSION TABLE     00095000
         DC    A(CONVTAB2)             SQLDA DATA TYPE/LENGTH TABLE     00096000
         DC    A(STM#TAB)              STATEMENT TABLE ADDRESS          00097000
         DC    CL43'COPYRIGHT 2017 INFOR. ALL RIGHTS RESERVED. '        00098000
         DC    CL29'WWW.INFOR.COM                '                      00098001
*                                                                       00099000
**********************************************************************  00100000
* STATEMENT TABLE SECTION:                                              00101000
*   THIS SECTION DEFINES AN ENTRY VECTOR FOR EACH SQL STATEMENT.        00102000
**********************************************************************  00103000
*                                                                       00104000
STM#TAB  CSECT                         STATEMENT TABLE SECTION          00105000
STM#TAB  AMODE ANY                                                      00106000
STM#TAB  RMODE ANY                                                      00107000
         DC    A(SELIN0)               SELECT INTO (KEY 0)              00108000
         DC    A(SELIN1)               SELECT INTO (KEY 1)              00109000
         DC    A(SELIN2)               SELECT INTO (KEY 2)              00110000
         DC    A(SELIN3)               SELECT INTO (KEY 3)              00111000
         DC    12A(0)                  UDB MODULE VECTORS               00112000
         DC    A(SELXC0)               SELECT SEQ CURSOR (KEY 0)        00113000
         DC    A(SELXC1)               SELECT SEQ CURSOR (KEY 1)        00114000
         DC    A(SELXC2)               SELECT SEQ CURSOR (KEY 2)        00115000
         DC    A(SELXC3)               SELECT SEQ CURSOR (KEY 3)        00116000
         DC    A(FETDC0)               FETCH SEQ DATA CURSOR (KEY 0)    00117000
         DC    A(FETDC1)               FETCH SEQ DATA CURSOR (KEY 1)    00118000
         DC    A(FETDC2)               FETCH SEQ DATA CURSOR (KEY 2)    00119000
         DC    A(FETDC3)               FETCH SEQ DATA CURSOR (KEY 3)    00120000
         DC    A(FETKC0)               FETCH SEQ KEY CURSOR (KEY 0)     00121000
         DC    A(FETKC1)               FETCH SEQ KEY CURSOR (KEY 1)     00122000
         DC    A(FETKC2)               FETCH SEQ KEY CURSOR (KEY 2)     00123000
         DC    A(FETKC3)               FETCH SEQ KEY CURSOR (KEY 3)     00124000
         DC    A(CLSXC0)               CLOSE SEQ CURSOR (KEY 0)         00125000
         DC    A(CLSXC1)               CLOSE SEQ CURSOR (KEY 1)         00126000
         DC    A(CLSXC2)               CLOSE SEQ CURSOR (KEY 2)         00127000
         DC    A(CLSXC3)               CLOSE SEQ CURSOR (KEY 3)         00128000
         DC    A(SELKY0)               SELECT KEY (KEY 0)               00129000
         DC    A(SELKY1)               SELECT KEY (KEY 1)               00130000
         DC    A(SELKY2)               SELECT KEY (KEY 2)               00131000
         DC    A(SELKY3)               SELECT KEY (KEY 3)               00132000
         DC    10A(0)                  UDB MODULE VECTORS               00133000
         DC    4X'FF'                                                   00134000
*                                                                       00135000
**********************************************************************  00136000
* SQL STATEMENT SECTION:                                                00137000
*   THIS SECTION CONTAINS ALL THE STATIC SQL STATEMENTS REQUIRED        00138000
*     TO SUPPORT THIS TABLE.                                            00139000
*   THE INDICATED STATEMENTS MAY BE MODIFIED, AS LONG AS THE RESULTS    00140000
*     ARE EQUIVALENT.                                                   00141000
**********************************************************************  00142000
*                                                                       00143000
SQL#STMT CSECT                         SQL STATEMENT SECTION            00144000
SQL#STMT AMODE ANY                                                      00145000
SQL#STMT RMODE ANY                                                      00146000
         USING SQDSQLDA,2              ADDRESS ROWSET SQLDA AREA        00147000
         USING SQLDSECT,10             ADDRESS SQLDSECT                 00148000
         USING COM#AREA,11             ADDRESS COMMAREA                 00149000
*                                                                       00150000
**********************************************************************  00151000
* SELECT INTO STATEMENT BY PRIMARY KEY:                                 00152000
*   THIS STATEMENT SUPPORTS THE GET (WITHOUT LOCK) VERB.                00153000
**********************************************************************  00154000
*                                                                       00155000
SELIN0   DS    0H                                                       00156000
         USING SELIN0,12               ESTABLISH BASE REGISTER          00157000
         MVI   SQWKMRP,X'80'           MOVE RECORD TO HOST FOR KEY 0    00158000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00159000
         BALR  14,15                   MOVE REQUESTED DATA              00160000
         EXEC  SQL SELECT                                              *00161000
                   AUDIT_DATE,                                         *00162000
                   AUDIT_TIME,                                         *00163000
                   AUDIT_USER,                                         *00164000
                   AUDIT_ORG,                                          *00165000
                   DESCRIPTION                                         *00166000
                 INTO                                                  *00167000
                   :AUDDATE,                                           *00168000
                   :AUDTIME,                                           *00169000
                   :AUDUSER,                                           *00170000
                   :AUDORG,                                            *00171000
                   :DESCRIPT                                           *00172000
                 FROM S08                                              *00173000
                 WHERE                                                 *00174000
                   INST_NBR = :INST AND                                *00175000
                   RECORD_NBR = :RECNBR AND                            *00176000
                   SERVICE_CODE = :SECSVCCD                            *00177000
                 FETCH FIRST 1 ROW ONLY                                 00178000
         MVI   SQWKMRP,X'03'           MOVE HOST VARIABLES TO RECORD    00179000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00180000
         BALR  14,15                   MOVE REQUESTED DATA              00181000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00182000
         BR    14                      RETURN TO CALLER                 00183000
         LTORG                                                          00184000
*                                                                       00185000
**********************************************************************  00186000
* SELECT COUNT STATEMENT BY PRIMARY KEY:                                00187000
*   THIS STATEMENT SUPPORTS THE LOCATE VERB.                            00188000
**********************************************************************  00189000
*                                                                       00190000
SELKY0   DS    0H                                                       00191000
         USING SELKY0,12               ESTABLISH BASE REGISTER          00192000
         MVI   SQWKMRP,X'80'           MOVE RECORD TO HOST FOR KEY 0    00193000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00194000
         BALR  14,15                   MOVE REQUESTED DATA              00195000
         EXEC  SQL SELECT                                              *00196000
                   COUNT(*)                                            *00197000
                 INTO                                                  *00198000
                   :SQWINTHV                                           *00199000
                 FROM S08                                              *00200000
                 WHERE                                                 *00201000
                   INST_NBR = :INST AND                                *00202000
                   RECORD_NBR = :RECNBR AND                            *00203000
                   SERVICE_CODE = :SECSVCCD                            *00204000
                 FETCH FIRST 1 ROW ONLY                                 00205000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00206000
         CLC   SQLCODE,=F'0'           GOOD RETURN FROM SQL?            00207000
         BNER  14                      NO - RETURN TO CALLER            00208000
         CLC   SQWINTHV,=F'0'          ANY ROWS MATCH WHERE CLAUSE?     00209000
         BNER  14                      YES - RETURN ZERO SQLCODE        00210000
         MVC   SQLCODE,=F'+100'        SET SQLCODE TO ROW NOT FOUND     00211000
         BR    14                      RETURN TO CALLER                 00212000
         LTORG                                                          00213000
*                                                                       00214000
**********************************************************************  00215000
* SELECT SEQUENTIAL AND OPEN SEQUENTIAL CURSOR STATEMENTS BY PRIMARY    00216000
* KEY:                                                                  00217000
*   THESE STATEMENTS SUPPORT THE GET-GE, GET-GE-LOCK, GET-NEXT,         00218000
*     AND GET-NEXT-LOCK VERBS.                                          00219000
*   A SELECT UPDATE STATEMENT WILL FOLLOW IN THE CASE OF A              00220000
*     GET-GE-LOCK OR GET-NEXT-LOCK VERB.                                00221000
**********************************************************************  00222000
*                                                                       00223000
SELXC0   DS    0H                                                       00224000
         USING SELXC0,12               ESTABLISH BASE REGISTER          00225000
         MVI   SQWKMRP,X'86'           SET HOST KEY 0 & CURSOR POINTER  00226000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00227000
         BALR  14,15                   MOVE DATA & SET CURSOR POINTER   00228000
         LA    12,SELXC0P              LOAD VECTOR TABLE ADDRESS        00229000
         AH    12,SQWCSRSP             COMPUTE POINTER TO OPEN ROUTINE  00230000
         L     12,0(12)                LOAD OPEN ROUTINE ADDRESS        00231000
         BR    12                      GO TO CURSOR OPEN ROUTINE        00232000
SELXC0P  DC    A(SELGE001)                                              00233000
         DC    (KY0COLMS-01)A(0)                                        00234000
         DC    A(SELGE002)                                              00235000
         DC    (KY0COLMS-02)A(0)                                        00236000
         DC    A(SELGE003)                                              00237000
         LTORG                                                          00238000
*                                                                       00239000
SELGE001 DS    0H                                                       00240000
         USING SELGE001,12             ESTABLISH BASE REGISTER          00241000
         EXEC  SQL DECLARE S08GE001 CURSOR                             *00242000
               WITH ROWSET POSITIONING                                 *00243000
               FOR SELECT                                              *00244000
                   INST_NBR,                                           *00245000
                   RECORD_NBR,                                         *00246000
                   SERVICE_CODE,                                       *00247000
                   AUDIT_DATE,                                         *00248000
                   AUDIT_TIME,                                         *00249000
                   AUDIT_USER,                                         *00250000
                   AUDIT_ORG,                                          *00251000
                   DESCRIPTION                                         *00252000
                 FROM S08                                              *00253000
                 WHERE                                                 *00254000
                   INST_NBR = :INST AND                                *00255000
                   RECORD_NBR = :RECNBR AND                            *00256000
                   SERVICE_CODE >=                                     *00257000
                     :SECSVCCD                                         *00258000
                 ORDER BY SERVICE_CODE ASC                             *00259000
                 OPTIMIZE FOR 1 ROW FOR READ ONLY                       00260000
         EXEC  SQL OPEN S08GE001                                        00261000
         MVC   SQWCSRCA,=A(CLSGE001)   SET CURSOR CLOSE ROUTINE ADDRESS 00262000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00263000
         BR    14                      RETURN TO CALLER                 00264000
         LTORG                                                          00265000
*                                                                       00266000
SELGE002 DS    0H                                                       00267000
         USING SELGE002,12             ESTABLISH BASE REGISTER          00268000
         EXEC  SQL DECLARE S08GE002 CURSOR                             *00269000
               WITH ROWSET POSITIONING                                 *00270000
               FOR SELECT                                              *00271000
                   INST_NBR,                                           *00272000
                   RECORD_NBR,                                         *00273000
                   SERVICE_CODE,                                       *00274000
                   AUDIT_DATE,                                         *00275000
                   AUDIT_TIME,                                         *00276000
                   AUDIT_USER,                                         *00277000
                   AUDIT_ORG,                                          *00278000
                   DESCRIPTION                                         *00279000
                 FROM S08                                              *00280000
                 WHERE                                                 *00281000
                   INST_NBR = :INST AND                                *00282000
                   RECORD_NBR >=                                       *00283000
                     :RECNBR                                           *00284000
                 ORDER BY RECORD_NBR ASC,                              *00285000
                   SERVICE_CODE ASC                                    *00286000
                 OPTIMIZE FOR 1 ROW FOR READ ONLY                       00287000
         EXEC  SQL OPEN S08GE002                                        00288000
         MVC   SQWCSRCA,=A(CLSGE002)   SET CURSOR CLOSE ROUTINE ADDRESS 00289000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00290000
         BR    14                      RETURN TO CALLER                 00291000
         LTORG                                                          00292000
*                                                                       00293000
SELGE003 DS    0H                                                       00294000
         USING SELGE003,12             ESTABLISH BASE REGISTER          00295000
         EXEC  SQL DECLARE S08GE003 CURSOR                             *00296000
               WITH ROWSET POSITIONING                                 *00297000
               FOR SELECT                                              *00298000
                   INST_NBR,                                           *00299000
                   RECORD_NBR,                                         *00300000
                   SERVICE_CODE,                                       *00301000
                   AUDIT_DATE,                                         *00302000
                   AUDIT_TIME,                                         *00303000
                   AUDIT_USER,                                         *00304000
                   AUDIT_ORG,                                          *00305000
                   DESCRIPTION                                         *00306000
                 FROM S08                                              *00307000
                 WHERE                                                 *00308000
                   INST_NBR >=                                         *00309000
                     :INST                                             *00310000
                 ORDER BY INST_NBR ASC,                                *00311000
                   RECORD_NBR ASC,                                     *00312000
                   SERVICE_CODE ASC                                    *00313000
                 OPTIMIZE FOR 1 ROW FOR READ ONLY                       00314000
         EXEC  SQL OPEN S08GE003                                        00315000
         MVC   SQWCSRCA,=A(CLSGE003)   SET CURSOR CLOSE ROUTINE ADDRESS 00316000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00317000
         BR    14                      RETURN TO CALLER                 00318000
         LTORG                                                          00319000
*                                                                       00320000
**********************************************************************  00321000
* SELECT AND OPEN SEQUENTIAL CURSOR STATEMENTS BY PRIMARY KEY:          00322000
*   THIS ROUTINE HANDLES PRIMARY KEY SEQUENTIAL CURSORS.                00323000
**********************************************************************  00324000
*                                                                       00325000
NXTXC0   DS    0H                                                       00326000
         USING NXTXC0,12               ESTABLISH BASE REGISTER          00327000
         MVI   SQWKMRP,X'87'           CLOSE CURSOR & SET HOST KEY 0    00328000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00329000
         BALR  14,15                   MOVE REQUESTED DATA              00330000
         LH    1,SQWCSRSP              LOAD CURRENT CURSOR POINTER      00331000
         LA    1,4(1)                  INCREMENT TO NEXT CURSOR         00332000
         STH   1,SQWCSRSP              SAVE POINTER FOR NEXT CALL       00333000
         LA    12,NXTXC0P(1)           LOAD POINTER TO NEXT CURSOR      00334000
         L     12,0(12)                LOAD CURSOR ROUTINE ADDRESS      00335000
         BR    12                      GO TO CURRENT CURSOR ROUTINE     00336000
NXTXC0P  DC    A(0)                                                     00337000
         DC    A(NXTGT002)                                              00338000
         DC    A(NXTGT003)                                              00339000
         DC    A(NXTGT099)                                              00340000
         DC    A(NXTGT003)                                              00341000
         DC    A(NXTGT099)                                              00342000
         DC    A(NXTGT099)                                              00343000
NXTGT099 LA    0,4                     LOAD VALUE 4 IN REGISTER 0       00344000
         SR    1,0                     ADJUST BACK TO CURRENT POINTER   00345000
         STH   1,SQWCSRSP              SAVE POINTER FOR CURSOR CLOSE    00346000
         LA    0,100                   LOAD VALUE 100 IN REGISTER 0     00347000
         ST    0,SQLCODE               SET SQLCODE TO NO MORE ROWS      00348000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00349000
         BR    14                      RETURN TO SQI                    00350000
         LTORG                                                          00351000
*                                                                       00352000
NXTGT002 DS    0H                                                       00353000
         USING NXTGT002,12             ESTABLISH BASE REGISTER          00354000
         EXEC  SQL DECLARE S08GT002 CURSOR                             *00355000
               WITH ROWSET POSITIONING                                 *00356000
               FOR SELECT                                              *00357000
                   INST_NBR,                                           *00358000
                   RECORD_NBR,                                         *00359000
                   SERVICE_CODE,                                       *00360000
                   AUDIT_DATE,                                         *00361000
                   AUDIT_TIME,                                         *00362000
                   AUDIT_USER,                                         *00363000
                   AUDIT_ORG,                                          *00364000
                   DESCRIPTION                                         *00365000
                 FROM S08                                              *00366000
                 WHERE                                                 *00367000
                   INST_NBR = :INST AND                                *00368000
                   RECORD_NBR >                                        *00369000
                     :RECNBR                                           *00370000
                 ORDER BY RECORD_NBR ASC,                              *00371000
                   SERVICE_CODE ASC                                    *00372000
                 OPTIMIZE FOR 1 ROW FOR READ ONLY                       00373000
         EXEC  SQL OPEN S08GT002                                        00374000
         ICM   15,B'1111',SQLCODE      IS RETURN CODE ZERO ?            00375000
         BNZ   *+14                    NO - RETURN ERROR                00376000
         MVC   SQWCSRCA,=A(CLSGT002)   SET CURSOR CLOSE ROUTINE ADDRESS 00377000
         L     12,SQWCSRRA             LOAD RETURN ADDRESS              00378000
         BR    12                      RETURN TO FETCH ROUTINE          00379000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00380000
         BR    14                      RETURN TO CALLER                 00381000
         LTORG                                                          00382000
*                                                                       00383000
NXTGT003 DS    0H                                                       00384000
         USING NXTGT003,12             ESTABLISH BASE REGISTER          00385000
         EXEC  SQL DECLARE S08GT003 CURSOR                             *00386000
               WITH ROWSET POSITIONING                                 *00387000
               FOR SELECT                                              *00388000
                   INST_NBR,                                           *00389000
                   RECORD_NBR,                                         *00390000
                   SERVICE_CODE,                                       *00391000
                   AUDIT_DATE,                                         *00392000
                   AUDIT_TIME,                                         *00393000
                   AUDIT_USER,                                         *00394000
                   AUDIT_ORG,                                          *00395000
                   DESCRIPTION                                         *00396000
                 FROM S08                                              *00397000
                 WHERE                                                 *00398000
                   INST_NBR >                                          *00399000
                     :INST                                             *00400000
                 ORDER BY INST_NBR ASC,                                *00401000
                   RECORD_NBR ASC,                                     *00402000
                   SERVICE_CODE ASC                                    *00403000
                 OPTIMIZE FOR 1 ROW FOR READ ONLY                       00404000
         EXEC  SQL OPEN S08GT003                                        00405000
         ICM   15,B'1111',SQLCODE      IS RETURN CODE ZERO ?            00406000
         BNZ   *+14                    NO - RETURN ERROR                00407000
         MVC   SQWCSRCA,=A(CLSGT003)   SET CURSOR CLOSE ROUTINE ADDRESS 00408000
         L     12,SQWCSRRA             LOAD RETURN ADDRESS              00409000
         BR    12                      RETURN TO FETCH ROUTINE          00410000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00411000
         BR    14                      RETURN TO CALLER                 00412000
         LTORG                                                          00413000
*                                                                       00414000
**********************************************************************  00415000
* FETCH FROM SEQUENTIAL CURSOR STATEMENT FOR PRIMARY KEY:               00416000
*   THIS STATEMENT SUPPORTS THE GET-GE AND GET-NEXT VERBS.              00417000
*   IT WILL FOLLOW A SUCCESSFUL SELECT SEQUENTIAL STATEMENT TO          00418000
*     RETRIEVE THE ACTUAL ROW.                                          00419000
*   THE GET-GE-LOCK AND GET-NEXT-LOCK VERBS USE A DIFFERENT             00420000
*     FETCH STATEMENT AS ONLY THE KEY FIELDS ARE NEEDED.                00421000
**********************************************************************  00422000
*                                                                       00423000
FETDC0   DS    0H                                                       00424000
         USING FETDC0,12               ESTABLISH BASE REGISTER          00425000
         MVC   SQWCSRRA,=A(FETDC0)     SET RETURN ROUTINE ADDRESS       00426000
         MVC   SQWCSRBR,=A(NXTXC0)     SET CURSOR ROUTINE ADDRESS       00427000
         MVC   SQWRSFVC,=AL2(TBLCOLMS) FETCH ALL COLUMNS IN TABLE       00428000
         LH    1,SQWCSRSP              LOAD CURRENT CURSOR POINTER      00429000
         LA    12,FETDC0P(1)           LOAD POINTER TO FETCH ROUTINE    00430000
         L     12,0(12)                LOAD FETCH ROUTINE ADDRESS       00431000
         BR    12                      GO TO CURRENT FETCH ROUTINE      00432000
FETDC0P  DC    A(FETGE001)                                              00433000
         DC    A(FETGT002)                                              00434000
         DC    A(FETGT003)                                              00435000
         DC    A(FETGE002)                                              00436000
         DC    A(FETGT003)                                              00437000
         DC    A(FETGE003)                                              00438000
         DC    A(0)                                                     00439000
         LTORG                                                          00440000
*                                                                       00441000
**********************************************************************  00442000
* FETCH FROM SEQUENTIAL CURSOR FOR EVENTUAL UPDATE STATEMENT FOR        00443000
* THE PRIMARY KEY:                                                      00444000
*   THIS STATEMENT SUPPORTS THE GET-GE-LOCK AND GET-NEXT-LOCK           00445000
*     VERBS.                                                            00446000
*   IT WILL FOLLOW A SUCCESSFUL SELECT SEQUENTIAL STATEMENT TO          00447000
*     RETRIEVE THE ACTUAL ROW.                                          00448000
*   ONLY THE PRIMARY KEY FIELDS ARE RETRIEVED AS A SELECT FOR UPDATE    00449000
*     STATEMENT WILL FOLLOW AND RETREIVAL OF THE ACTUAL ROW             00450000
*     WILL BE THRU THE UPDATE CURSOR.                                   00451000
**********************************************************************  00452000
*                                                                       00453000
FETKC0   DS    0H                                                       00454000
         USING FETKC0,12               ESTABLISH BASE REGISTER          00455000
         MVC   SQWCSRRA,=A(FETKC0)     SET RETURN ROUTINE ADDRESS       00456000
         MVC   SQWCSRBR,=A(NXTXC0)     SET CURSOR ROUTINE ADDRESS       00457000
         MVC   SQWRSFVC,=AL2(KY0COLMS) ONLY FETCH KEY COLUMNS           00458000
         LH    1,SQWCSRSP              LOAD CURRENT CURSOR POINTER      00459000
         LA    12,FETKC0P(1)           LOAD POINTER TO FETCH ROUTINE    00460000
         L     12,0(12)                LOAD FETCH ROUTINE ADDRESS       00461000
         BR    12                      GO TO CURRENT FETCH ROUTINE      00462000
FETKC0P  DC    A(FETGE001)                                              00463000
         DC    A(FETGT002)                                              00464000
         DC    A(FETGT003)                                              00465000
         DC    A(FETGE002)                                              00466000
         DC    A(FETGT003)                                              00467000
         DC    A(FETGE003)                                              00468000
         DC    A(0)                                                     00469000
         LTORG                                                          00470000
*                                                                       00471000
FETGE001 DS    0H                                                       00472000
         USING FETGE001,12             ESTABLISH BASE REGISTER          00473000
         MVI   SQWKMRP,X'04'           CHECK FOR MORE ROWS IN ROWSET    00474000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00475000
         BALR  14,15                   MOVE REQUESTED DATA              00476000
         EXEC  SQL FETCH NEXT ROWSET FROM S08GE001                     *00477000
               FOR :SQWRSRMX ROWS INTO DESCRIPTOR :SQDSQLDA             00478000
         MVI   SQWKMRP,X'05'           MOVE HOST ARRAY DATA TO RECORD   00479000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00480000
         BALR  14,15                   MOVE REQUESTED DATA              00481000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00482000
         BR    14                      RETURN TO CALLER                 00483000
         LTORG                                                          00484000
*                                                                       00485000
FETGE002 DS    0H                                                       00486000
         USING FETGE002,12             ESTABLISH BASE REGISTER          00487000
         MVI   SQWKMRP,X'04'           CHECK FOR MORE ROWS IN ROWSET    00488000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00489000
         BALR  14,15                   MOVE REQUESTED DATA              00490000
         EXEC  SQL FETCH NEXT ROWSET FROM S08GE002                     *00491000
               FOR :SQWRSRMX ROWS INTO DESCRIPTOR :SQDSQLDA             00492000
         MVI   SQWKMRP,X'05'           MOVE HOST ARRAY DATA TO RECORD   00493000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00494000
         BALR  14,15                   MOVE REQUESTED DATA              00495000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00496000
         BR    14                      RETURN TO CALLER                 00497000
         LTORG                                                          00498000
*                                                                       00499000
FETGE003 DS    0H                                                       00500000
         USING FETGE003,12             ESTABLISH BASE REGISTER          00501000
         MVI   SQWKMRP,X'04'           CHECK FOR MORE ROWS IN ROWSET    00502000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00503000
         BALR  14,15                   MOVE REQUESTED DATA              00504000
         EXEC  SQL FETCH NEXT ROWSET FROM S08GE003                     *00505000
               FOR :SQWRSRMX ROWS INTO DESCRIPTOR :SQDSQLDA             00506000
         MVI   SQWKMRP,X'05'           MOVE HOST ARRAY DATA TO RECORD   00507000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00508000
         BALR  14,15                   MOVE REQUESTED DATA              00509000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00510000
         BR    14                      RETURN TO CALLER                 00511000
         LTORG                                                          00512000
*                                                                       00513000
FETGT002 DS    0H                                                       00514000
         USING FETGT002,12             ESTABLISH BASE REGISTER          00515000
         MVI   SQWKMRP,X'04'           CHECK FOR MORE ROWS IN ROWSET    00516000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00517000
         BALR  14,15                   MOVE REQUESTED DATA              00518000
         EXEC  SQL FETCH NEXT ROWSET FROM S08GT002                     *00519000
               FOR :SQWRSRMX ROWS INTO DESCRIPTOR :SQDSQLDA             00520000
         MVI   SQWKMRP,X'05'           MOVE HOST ARRAY DATA TO RECORD   00521000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00522000
         BALR  14,15                   MOVE REQUESTED DATA              00523000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00524000
         BR    14                      RETURN TO CALLER                 00525000
         LTORG                                                          00526000
*                                                                       00527000
FETGT003 DS    0H                                                       00528000
         USING FETGT003,12             ESTABLISH BASE REGISTER          00529000
         MVI   SQWKMRP,X'04'           CHECK FOR MORE ROWS IN ROWSET    00530000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00531000
         BALR  14,15                   MOVE REQUESTED DATA              00532000
         EXEC  SQL FETCH NEXT ROWSET FROM S08GT003                     *00533000
               FOR :SQWRSRMX ROWS INTO DESCRIPTOR :SQDSQLDA             00534000
         MVI   SQWKMRP,X'05'           MOVE HOST ARRAY DATA TO RECORD   00535000
         L     15,SQW@SQRX             LOAD INTERFACE ROUTINE ADDRESS   00536000
         BALR  14,15                   MOVE REQUESTED DATA              00537000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00538000
         BR    14                      RETURN TO CALLER                 00539000
         LTORG                                                          00540000
*                                                                       00541000
**********************************************************************  00542000
* CLOSE SEQUENTIAL CURSOR STATEMENT FOR PRIMARY KEY:                    00543000
*   THIS STATEMENT SUPPORTS THE GET-GE, GET-GE-LOCK, GET-NEXT,          00544000
*     AND GET-NEXT-LOCK VERBS.                                          00545000
*   IT WILL FOLLOW THE LAST FETCH FROM SEQUENTIAL CURSOR STATEMENT      00546000
*     TO CLOSE THE SEQUENTIAL CURSOR.                                   00547000
**********************************************************************  00548000
*                                                                       00549000
CLSXC0   DS    0H                                                       00550000
         USING CLSXC0,12               ESTABLISH BASE REGISTER          00551000
         L     12,SQWCSRCA             SET CURSOR CLOSE ROUTINE ADDRESS 00552000
         XC    SQWCSRCA,SQWCSRCA       CLEAR CURSOR CLOSE ROUTINE ADDR  00553000
         BR    12                      GO TO CURSOR CLOSE ROUTINE       00554000
         LTORG                                                          00555000
*                                                                       00556000
CLSGE001 DS    0H                                                       00557000
         USING CLSGE001,12             ESTABLISH BASE REGISTER          00558000
         EXEC  SQL CLOSE S08GE001                                       00559000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00560000
         BR    14                      RETURN TO CALLER                 00561000
         LTORG                                                          00562000
*                                                                       00563000
CLSGE002 DS    0H                                                       00564000
         USING CLSGE002,12             ESTABLISH BASE REGISTER          00565000
         EXEC  SQL CLOSE S08GE002                                       00566000
         L     14,SQW@RET                                               00567000
         BR    14                                                       00568000
         LTORG                                                          00569000
*                                                                       00570000
CLSGE003 DS    0H                                                       00571000
         USING CLSGE003,12             ESTABLISH BASE REGISTER          00572000
         EXEC  SQL CLOSE S08GE003                                       00573000
         L     14,SQW@RET                                               00574000
         BR    14                                                       00575000
         LTORG                                                          00576000
*                                                                       00577000
CLSGT002 DS    0H                                                       00578000
         USING CLSGT002,12             ESTABLISH BASE REGISTER          00579000
         EXEC  SQL CLOSE S08GT002                                       00580000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00581000
         BR    14                      RETURN TO CALLER                 00582000
         LTORG                                                          00583000
*                                                                       00584000
CLSGT003 DS    0H                                                       00585000
         USING CLSGT003,12             ESTABLISH BASE REGISTER          00586000
         EXEC  SQL CLOSE S08GT003                                       00587000
         L     14,SQW@RET              LOAD RETURN ADDRESS              00588000
         BR    14                      RETURN TO CALLER                 00589000
         LTORG                                                          00590000
*                                                                       00591000
**********************************************************************  00592000
* ALTERNATE KEY 1 NOT DEFINED                                           00593000
**********************************************************************  00594000
*                                                                       00595000
SELIN1   DS    0H                                                       00596000
SELKY1   DS    0H                                                       00597000
SELXC1   DS    0H                                                       00598000
FETDC1   DS    0H                                                       00599000
FETKC1   DS    0H                                                       00600000
CLSXC1   DS    0H                                                       00601000
         DC    X'00DEAD01'             FORCE S0C1 ABEND                 00602000
*                                                                       00603000
**********************************************************************  00604000
* ALTERNATE KEY 2 NOT DEFINED                                           00605000
**********************************************************************  00606000
*                                                                       00607000
SELIN2   DS    0H                                                       00608000
SELKY2   DS    0H                                                       00609000
SELXC2   DS    0H                                                       00610000
FETDC2   DS    0H                                                       00611000
FETKC2   DS    0H                                                       00612000
CLSXC2   DS    0H                                                       00613000
         DC    X'00DEAD02'             FORCE S0C1 ABEND                 00614000
*                                                                       00615000
**********************************************************************  00616000
* ALTERNATE KEY 3 NOT DEFINED                                           00617000
**********************************************************************  00618000
*                                                                       00619000
SELIN3   DS    0H                                                       00620000
SELKY3   DS    0H                                                       00621000
SELXC3   DS    0H                                                       00622000
FETDC3   DS    0H                                                       00623000
FETKC3   DS    0H                                                       00624000
CLSXC3   DS    0H                                                       00625000
         DC    X'00DEAD03'             FORCE S0C1 ABEND                 00626000
*                                                                       00627000
         DS    0H                      END OF SQL STATEMENTS            00628000
         DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF'                   00629000
*                                                                       00630000
**********************************************************************  00631000
* DUMMY ENTRY POINT DSNHLI                                              00632000
**********************************************************************  00633000
*                                                                       00634000
         ENTRY DSNHLI                                                   00635000
DSNHLI   DS    0H                                                       00636000
         L     15,SQW@CAF              LOAD ENTRY POINT TO ATTACH       00637000
         BR    15                      BRANCH TO ATTACH FACILITY        00638000
*                                                                       00639000
**********************************************************************  00640000
* CONVERSION TABLE VALUES FOR ALL FIELDS IN THIS TABLE                  00641000
**********************************************************************  00642000
*                                                                       00643000
* CONVTAB1 TABLE ENTRY FORMAT IS:                                       00644000
*        DC    H'RRRR',H'VVVV',H'LLLL',X'KK',X'DD'                      00645000
* OR:                                                                   00646000
*        DC    H'RRRR',H'VVVV',X'ZZPP',X'KK',X'DD'                      00647000
* WHERE:                                                                00648000
*   RRRR = RECORD AREA OFFSET                                           00649000
*   VVVV = HOST VARIABLE AREA OFFSET                                    00650000
*   LLLL = HALFWORD LENGTH TO MOVE                                      00651000
*   ZZPP = CONVERT ZONED/PACKED LENGTHS (MINUS 1)                       00652000
*   KK   = KEY FIELD MASK:                                              00653000
*            80 = KEY 0 FIELD                                           00654000
*            40 = KEY 1 FIELD                                           00655000
*            20 = KEY 2 FIELD                                           00656000
*            10 = KEY 3 FIELD                                           00657000
*   DD   = DATA FIELD MASK:                                             00658000
*            80 = RECORD FIELD IS PACKED                                00659000
*            40 = HOST VARIABLE IS PACKED                               00660000
*            20 = NULLABLE FIELD                                        00661000
*            01 = DATE FIELD                                            00662000
*            02 = TIME FIELD                                            00663000
*                                                                       00664000
CONVTAB1 DS    0H                      RECORD/HOST VARIABLE CONVERSIONS 00665000
         DC    H'0000',H'0000',H'0014',X'80',X'00'                      00666000
         DC    H'0014',H'0014',H'0054',X'00',X'00'                      00667000
         DC    8X'FF'                                                   00668000
*                                                                       00669000
* CONVTAB2 TABLE COLUMNS ENTRY FORMAT IS:                               00670000
*        DC    H'RRRR',H'LLLL',H'TTTT'                                  00671000
* OR:                                                                   00672000
*        DC    H'RRRR',X'PPSS',H'TTTT'                                  00673000
* WHERE:                                                                00674000
*   RRRR = RECORD AREA OFFSET                                           00675000
*   LLLL = HALFWORD LENGTH OF HOST VARIABLE (NON-DECIMAL DATA TYPE)     00676000
*   PPSS = PRECISION AND SCALE (DECIMAL DATA TYPE)                      00677000
*   TTTT = SQLDA DATA TYPE:                                             00678000
*            452 = CHAR       453 = CHAR NULLABLE                       00679000
*            484 = DECIMAL    485 = DECIMAL NULLABLE                    00680000
*            496 = INTEGER    497 = INTEGER NULLABLE                    00681000
*            500 = SMALLINT   501 = SMALLINT NULLABLE                   00682000
*                                                                       00683000
CONVTAB2 DS    0F                      RECORD DATA ATTRIBUTE TABLE      00684000
         DC    AL4(TBLCOLMS*44+16)     TOTAL SQLDA SIZE                 00685000
         DC    AL2(TBLCOLMS)           NUMBER OF COLUMNS IN TABLE       00686000
         DC    AL2(KY0COLMS)           NUMBER OF PRIMARY KEY COLUMNS    00687000
         DC    AL2(KY1COLMS)           NUMBER OF ALT1 KEY COLUMNS       00688000
         DC    AL2(KY2COLMS)           NUMBER OF ALT2 KEY COLUMNS       00689000
         DC    AL2(KY3COLMS)           NUMBER OF ALT3 KEY COLUMNS       00690000
         DC    AL2(00068)              SUMMATION OF ALL COLUMN LENGTHS  00691000
         DC    AL2(01000)              PRIMARY MULTIROW FETCH ARRAY     00692000
         DC    AL2(00000)              ALT 1 MULTIROW FETCH ARRAY       00693000
         DC    AL2(00000)              ALT 2 MULTIROW FETCH ARRAY       00694000
         DC    AL2(00000)              ALT 3 MULTIROW FETCH ARRAY       00695000
         DC    AL2(00000)              PRIMARY KEY LOW VALUE LEVEL      00696000
         DC    AL2(00000)              ALT 1 KEY LOW VALUE LEVEL        00697000
         DC    AL2(00000)              ALT 2 KEY LOW VALUE LEVEL        00698000
         DC    AL2(00000)              ALT 3 KEY LOW VALUE LEVEL        00699000
CONVDATA DS    0H                                                       00700000
         DC    H'0000',H'0004',H'452'  INST_NBR                         00701000
         DC    H'0004',H'0004',H'452'  RECORD_NBR                       00702000
         DC    H'0008',H'0006',H'452'  SERVICE_CODE                     00703000
KEYCOLMS EQU   (*-CONVDATA)/6          NUMBER OF KEY COLUMNS IN TABLE   00704000
         DC    H'0014',X'0900',H'484'  AUDIT_DATE                       00705000
         DC    H'0019',X'0900',H'484'  AUDIT_TIME                       00706000
         DC    H'0024',H'0008',H'452'  AUDIT_USER                       00707000
         DC    H'0032',H'0006',H'452'  AUDIT_ORG                        00708000
         DC    H'0038',H'0030',H'452'  DESCRIPTION                      00709000
TBLCOLMS EQU   (*-CONVDATA)/6          NUMBER OF COLUMNS IN TABLE       00710000
KY0COLMS EQU   00003                   NUMBER OF PRIMARY KEY COLUMNS    00711000
KY1COLMS EQU   00000                   NUMBER OF ALT 1 KEY COLUMNS      00712000
KY2COLMS EQU   00000                   NUMBER OF ALT 2 KEY COLUMNS      00713000
KY3COLMS EQU   00000                   NUMBER OF ALT 3 KEY COLUMNS      00714000
*                                                                       00715000
         LTORG                                                          00716000
         END                                                            00717000
